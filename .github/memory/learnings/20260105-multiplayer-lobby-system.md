# 2026-01-05 多人遊戲大廳系統設計

## 學到的內容

### WebSocket 遊戲狀態管理
- 使用伺服器端狀態機管理遊戲流程 (`waiting` → `playing`)
- 透過 `broadcastLobbyState()` 同步所有客戶端的大廳狀態
- 將遊戲邏輯與大廳邏輯分離，提高可維護性

### 彈性的玩家加入機制
- 允許遊戲進行中途加入新玩家
- 根據當前遊戲狀態決定是否立即生成蛇
- 死亡玩家可以重生，無需等待遊戲結束

### 客戶端 UI 狀態同步
- 使用 `updateUI()` 集中管理按鈕顯示邏輯
- 根據 `serverGameState` 切換大廳/遊戲介面
- 視覺化顯示玩家準備狀態和生存狀態

### 訊息協議設計
新增的 WebSocket 訊息類型：
- `lobbyUpdate`: 廣播大廳狀態（玩家列表、準備狀態）
- `ready`: 玩家切換準備狀態
- `start`: 任何玩家可以啟動遊戲
- `respawn`: 死亡玩家請求重生
- `gameStart`: 伺服器通知遊戲開始

## 適用情境

1. **需要等待多位玩家的多人遊戲**
   - 競技遊戲（貪食蛇、賽車等）
   - 合作遊戲

2. **允許中途加入的遊戲**
   - 開放世界遊戲
   - 持續性對戰遊戲

3. **快速重開的遊戲**
   - 死亡後立即重生
   - 無需等待回合結束

## 關鍵設計決策

### 為何允許任何人開始遊戲？
- 降低等待時間，提高遊戲流暢度
- 避免「等不到所有人準備」的僵局
- 適合休閒遊戲的快節奏體驗

### 為何支援遊戲中加入？
- 提高伺服器利用率
- 降低玩家等待時間
- 適合持續性遊戲體驗

### 為何移除單機模式？
- 簡化程式碼邏輯
- 專注於多人連線體驗
- 避免雙重維護兩套遊戲邏輯

## 可能的改進方向

1. **房間系統**：支援多個獨立房間
2. **觀戰模式**：死亡玩家可以觀看其他玩家
3. **倒數計時**：開始遊戲前 3 秒倒數
4. **最小玩家數**：設定最少 2 人才能開始
5. **踢除玩家**：房主可以踢除不活躍玩家
