# 2026-01-05 大廳系統架構決策

## 背景
使用者要求為多人貪食蛇遊戲新增連線大廳功能，讓所有玩家在同一個伺服器上遊玩，並可以隨時開始遊戲。

## 選項

### 選項 1：傳統大廳（需所有人準備）
**特點**：
- 玩家必須點擊「準備」
- 只有當所有玩家都準備好時才能開始
- 房主可以強制開始

**優點**：
- 公平性高，確保所有人都準備好
- 適合競技性遊戲

**缺點**：
- 可能長時間等待
- 單一玩家不準備會阻擋所有人

### 選項 2：快速開始大廳（任何人可開始）✅ 採用
**特點**：
- 玩家可以選擇準備（視覺化狀態）
- 任何玩家隨時可以點擊「開始遊戲」
- 遊戲中可以加入新玩家
- 死亡後可以立即重生

**優點**：
- 遊戲流暢度高
- 無需等待所有人準備
- 適合休閒遊戲
- 降低進入門檻

**缺點**：
- 可能有玩家還沒準備好就開始
- 需要處理遊戲中途加入的邏輯

### 選項 3：房間系統
**特點**：
- 多個獨立房間
- 每個房間有獨立的遊戲循環
- 房主管理

**優點**：
- 支援多組玩家同時遊玩
- 更好的隔離性

**缺點**：
- 實作複雜度高
- 需要房間管理介面

## 決定
採用**選項 2：快速開始大廳**

## 原因

1. **符合使用者需求**
   - 使用者明確要求「可以隨時開始」
   - 不需要等待機制

2. **適合遊戲類型**
   - 貪食蛇是休閒遊戲，不需要嚴格的準備機制
   - 死亡後重生適合快節奏體驗

3. **實作複雜度適中**
   - 相比房間系統更簡單
   - 保留準備機制作為視覺化狀態

4. **良好的使用者體驗**
   - 降低等待時間
   - 提高遊戲流暢度
   - 隨時可以加入遊玩

## 技術實作

### 伺服器端
```javascript
let gameState = 'waiting'; // 全域遊戲狀態

// 任何玩家可以啟動遊戲
case 'start':
    startGame();
    break;

// 遊戲中加入的玩家立即獲得蛇
if (gameState === 'playing') {
    player.snake = createSnake(color);
}
```

### 客戶端
```javascript
// 根據遊戲狀態顯示不同按鈕
if (serverGameState === 'waiting') {
    // 顯示準備和開始按鈕
} else {
    // 顯示重生按鈕（如果死亡）
}
```

## 後續考量

如果未來需要支援多個房間，可以重構為：
1. 將當前全域狀態封裝為 `Room` 類別
2. 管理多個 `Room` 實例
3. 玩家連線時選擇或建立房間

這個架構設計保留了未來擴展的彈性。
